# å‰ç«¯å¼‚æ­¥ç¼–ç¨‹

> å½“æˆ‘ä»¬åœ¨è°ˆè®ºå¼‚æ­¥ç¼–ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨è°ˆè®ºä»€ä¹ˆï¼Ÿ

åŒæ­¥è¡Œä¸ºå’Œå¼‚æ­¥è¡Œä¸ºåœ¨è®¡ç®—æœºç§‘å­¦ä¸­æ˜¯ä¸€ä¸ªç›¸å¯¹çš„åŸºæœ¬æ¦‚å¿µã€‚åŒæ­¥å³ä¸ºæ¯æ¡ä»£ç æŒ‡ä»¤éƒ½æ˜¯æŒ‰ç…§å†…å­˜ä¸­çš„é¡ºåºæ‰§è¡Œï¼ŒäºŒæ‰§è¡Œåä¹Ÿèƒ½ç«‹åˆ»è·å–ç³»ç»Ÿæœ¬åœ°çš„ä¿¡æ¯ã€‚

å¼‚æ­¥å’ŒåŒæ­¥ä¸¥æ ¼æŒ‰ç…§é¡ºåºæ‰§è¡Œä¸åŒï¼Œæ›´ç±»ä¼¼äº**ç³»ç»Ÿä¸­æ–­**ï¼Œå³ç¨‹åºä¹‹å¤–çš„äº‹åŠ¡å¯ä»¥è§¦å‘ä»£ç çš„æ‰§è¡Œã€‚ä¾‹å¦‚éœ€æ±‚æ˜¯åœ¨ä¸€æ®µå¾ˆå¾ˆé•¿çš„ç­‰å¾…åéœ€è¦æ‰§è¡Œä¸€æ®µä»£ç ï¼Œæˆ–è€…æ˜¯è·å–é«˜å»¶è¿Ÿçš„èµ„æºï¼Œå°±éœ€è¦ä½¿ç”¨å¼‚æ­¥æ¥é¿å…ç¨‹åºé•¿æ—¶é—´å¤„äº**å‡æ­»**çŠ¶æ€ã€‚

ç„¶è€Œï¼Œè®¾è®¡ä¸€å¥—å¯ç”¨&å¥½ç”¨çš„å¼‚æ­¥ç³»ç»Ÿå…¶å®æ˜¯éå¸¸å›°éš¾çš„ã€‚æœ¬æ–‡å°±æ˜¯å›é¡¾ä¸€ä¸‹JavaScriptè¿™ä¹ˆå¤šå¹´çš„åŠªåŠ›æ˜¯å¦‚ä½•å®ç°ä¸€ä¸ªå¯&å¥½çš„å¼‚æ­¥ç³»ç»Ÿçš„ã€‚

### 1.æ—§æ—¶ä»£çš„æ•‘æ˜Ÿ-å›è°ƒå‡½æ•°ï¼ˆcallback functionï¼‰

å¦‚æœæŠŠJavaScriptçœ‹ä½œä¸€éƒ¨ç”µå½±ã€‚

> åœ¨å·¨é¾™è‚†è™çš„æ‘åº„ï¼Œè¿æ¥äº†ä¸€ä½å‹‡å£«

#### 1.1ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°

>  **A callback is a function that is passed as an argument to another function and is executed after its parent function has completed.**

Google æä¾›çš„å®šä¹‰ï¼Œéå¸¸æ¸…æ™°ç®€æ˜ã€‚ä¸€ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªä½œä¸ºå…¶ä»–å‡½æ•°å‚æ•°çš„å‡½æ•°ï¼Œä¸€ä¸ªå…¶ä»–å‡½æ•°å®Œæˆåå†è¢«è°ƒç”¨çš„å‡½æ•°ã€‚å¼‚æ­¥çš„å®šä¹‰ï¼š**ç¨‹åºä¹‹å¤–çš„äº‹åŠ¡å¯ä»¥è§¦å‘ä»£ç çš„æ‰§è¡Œ**ï¼Œå°±è¿™æ · callbackæˆä¸ºäº†JavaScriptçš„å¼‚æ­¥ç¼–ç¨‹ä¸€ä»£ç›®ã€‚

ğŸŒ°ï¼š

![image-20201008134621244](C:\Users\13174\AppData\Roaming\Typora\typora-user-images\image-20201008134621244.png)

click å‡½æ•°çš„å‚æ•°å°±æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰ï¼Œè¿™ä¸ª callback æ˜¯ click å‡½æ•°çš„å‚æ•°ï¼Œæ˜¯åœ¨ body å…ƒç´ è¢«ç‚¹å‡»åè¿è¡Œçš„å‡½æ•°ã€‚

#### 1.2å›è°ƒå‡½æ•°çš„é—®é¢˜

> å± é¾™çš„å‹‡å£«ï¼Œç»ˆæˆæš´å›

callbackå¯æ˜¯å¯ç”¨ï¼Œä½†æ˜¯çœŸçš„éš¾ç”¨ï¼Œç‰¹åˆ«æ˜¯ä¸šåŠ¡é€»è¾‘å¤æ‚ä¹‹åå°±ä¼šäº§ç”Ÿ----å›è°ƒåœ°ç‹±ï¼ˆcallback hellï¼‰

```javascript
function move(x, y, cb) {} //ä¸€ä¸ªæ§åˆ¶x,yè½´ç§»åŠ¨çš„å‡½æ•°

//å®ç°ç§»åŠ¨å¤šæ¬¡çš„éœ€æ±‚
move(100, 100, function () {
  move(200, 200, function () {
    move(300, 300, function () {
      move(400, 400, function () {
        move(500, 500, function () {
          move(600, 600, function () {
            move(700, 700, function () {
              move(800, 800, function () {
                move(900, 900, function () {
                  move(1000, 2000, function () {});
                });
              });
            });
          });
        });
      });
    });
  });
});
```

ç±»ä¼¼äºé‡‘å­—å¡”èˆ¬çš„ç»“æ„ï¼Œæƒ³ä¸åˆ°ä»£ç æœ‰ä¸€å¤©èƒ½å¦‚æ­¤ä¼˜é›…ï¼ˆç¬‘ã€‚

### 2.æ–°æ—¶ä»£çš„å‹‡è€…-Promise

> éšç€ES6çš„æ›´æ–°ï¼Œè¿æ¥äº†æ–°çš„å‹‡è€… Promiseï¼Œä»æ­¤å‰ç«¯å‘Šåˆ«è›®è’çš„åˆ€å‰‘ï¼Œè¿›å…¥é­”æ³•æ—¶ä»£ã€‚

#### 2.1 Promiseå‘å±•å²

å…¶å®åœ¨ES6è§„èŒƒä¹‹å‰ï¼Œpromiseå·²ç»è¢«å¾ˆå¤šåº“ï¼ˆjQueryã€Dojoï¼‰ä½¿ç”¨ï¼Œä¹Ÿæœ‰æ—©æœŸçš„å®ç°åº“ï¼ˆQã€Bluebirdï¼‰ï¼Œåªæ˜¯æ²¡æœ‰ç»Ÿä¸€è§„èŒƒã€‚ä¸ºäº†ç»Ÿä¸€è§„èŒƒï¼Œ2012å¹´ï¼ŒPromise/A+ ç»„ç»‡forkäº†ä¸€ä»½CommonJSçš„Promise/Aã€‚æœ€åES6ä»¥Promise/A+çš„ä»£ç ä¸ºèŒƒæœ¬ï¼Œå¢åŠ äº†**Promise**å¯¹è±¡ã€‚å°†Javascriptä»callback hellä¸­è§£æ•‘å‡ºæ¥ï¼Œæ…¢æ…¢ä¸»å¯¼äº†jså¼‚æ­¥ç¼–ç¨‹çš„æœºåˆ¶ã€‚

#### 2.2 Promise åŸºç¡€çŸ¥è¯†

##### 2.2.1 promiseçŠ¶æ€æœº

pendingï¼ˆå¾…å®šï¼‰

resolvedï¼ˆæˆåŠŸï¼‰

rejectedï¼ˆå¤±è´¥ï¼‰

pendingï¼Œå³å¾…å®šï¼Œæ˜¯promiseæœ€å¼€å§‹çš„çŠ¶æ€ï¼Œpromiseéœ€è¦ä»pendingçŠ¶æ€ï¼Œè½¬åŒ–æˆresolvedæˆ–è€…rejectedçŠ¶æ€ï¼Œä¸”è½¬åŒ–åçŠ¶æ€ä¸å¯é€†ï¼Œä¸å¯å†æ¬¡æ”¹å˜ã€‚åŒæ—¶promiseçš„çŠ¶æ€æ˜¯ç§æœ‰çš„ï¼Œä¸å¯è¢«æ£€æµ‹å’Œä¿®æ”¹ã€‚å³promiseæ˜¯å·²å°è£…å¥½çš„å¼‚æ­¥è¡Œä¸ºï¼Œéš”ç»äº†å¤–éƒ¨åŒæ­¥ä»£ç ã€‚

##### 2.2.2 è§£å†³å’Œæ‹’ç»åŠç”¨ä¾‹

promiseä¸»è¦æœ‰ä¸¤ç§ç”¨é€”.

ä¸€ä¸ªæ˜¯æŠ½è±¡è¡¨ç¤ºå¼‚æ­¥ï¼Œresolvedè¡¨ç¤ºæˆåŠŸï¼Œrejectedè¡¨ç¤ºå¤±è´¥ã€‚ä¾‹å¦‚ï¼Œå‘é€ä¸€ä¸ªhttpè¯·æ±‚ï¼Œè‹¥çŠ¶æ€ç è¿”å›200~299åˆ™resolvedè¡¨ç¤ºæˆåŠŸï¼Œå¦åˆ™rejectedè¡¨ç¤ºå¤±è´¥ã€‚

å¦ä¸€ä¸ªå°±æ˜¯å¼‚æ­¥åï¼Œéœ€è¦è¿”å›ä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œä¾‹å¦‚ï¼Œå‘é€ä¸€ä¸ªhttpè¯·æ±‚ï¼Œè‹¥çŠ¶æ€ç è¿”å›200~299åˆ™resolved(data),è¿”å›å…·ä½“è¯·æ±‚æ‹¿åˆ°çš„å€¼ï¼Œå¦åˆ™rejected(Error)è¿”å›ä¸€ä¸ªErrorå¯¹è±¡ã€‚

ä¸ºäº†æ”¯æŒä¸Šé¢ä¸¤ç§ç”¨ä¾‹ï¼Œæ¯æ¬¡promiseçš„çŠ¶æ€å˜åŒ–åï¼Œä¼šæœ‰ä¸€ä¸ªç§æœ‰å€¼ä¼ é€’å‡ºå»ã€‚è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªå¯é€‰å€¼ï¼Œé»˜è®¤ä¸º**undefined**ã€‚

promiseçŠ¶æ€ç”¨ä¾‹ï¼š

```javascript
let p1 = new Promise((resolve, reject) => resolve());
setTimeout(console.log(p1), 0); // Promise <resolved>

let p2 = new Promise((resolve, reject) => reject());
setTimeout(console.log(p2), 0); // Promise <rejected>
```

çŠ¶æ€ä¸å¯å˜ç”¨ä¾‹ï¼š

```javascript
let p = new Promise((resolve, reject) => {
  resolve();
  reject(); // æ²¡æœ‰æ•ˆæœ
});

setTimeout(console.log, 0, p); // Promise <resolved>
```

##### 2.2.3 é»˜è®¤çŠ¶æ€çš„è¯­æ³•ç³–

promiseå…è®¸å®ä¾‹åŒ–å·²ç»è½å®šæœ€åçŠ¶æ€çš„promiseå¯¹è±¡ã€‚åˆ†åˆ«ä½¿ç”¨Promise.resolve()å’ŒPromise.reject()é™æ€æ–¹æ³•å®ç°ã€‚

```javascript
//resolved
let p1 = new Promise((resolve, reject) => resolve());
let p2 = Promise.resolve();

//reject
let p1 = new Promise((resolve, reject) => reject());
let p2 = Promise.reject();
```

p2ä»…ä»…æ˜¯p1çš„è¯­æ³•ç³–ã€‚

è¿™ä¸ªæ–¹æ³•ä¸»è¦ç›®çš„æ˜¯å°†éPromiseå€¼åŒ…è£…æˆä¸€ä¸ªè½å®šçŠ¶æ€çš„Promiseã€‚

```javascript
let p = Promise.resolve(new Error('foo'));

setTimeout(console.log, 0, p);
// Promise <resolved>: Error: foo
```

é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦æŠŠéPromiseå€¼åŒ…è£…æˆä¸€ä¸ªè½å®šçŠ¶æ€çš„Promiseå‘¢ï¼ŸPromiseçš„é“¾å¼è°ƒç”¨ï¼Œå…ˆæŒ‰ä¸‹ä¸è¡¨ï¼Œåæ–‡è¯¦è§£ã€‚

##### 2.2.4 åŒæ­¥å¼‚æ­¥äºŒå…ƒæ€§

```javascript
try {
  throw new Error('foo');
} catch(e) {
  console.log(e); // Error: foo
}

try {
  Promise.reject(new Error('bar'));
} catch(e) {
  console.log(e);
}
// Uncaught (in promise) Error: barja
```

å³ä½¿ç”¨tryæ˜¯catchä¸åˆ°promise.reject()çš„ä¸åˆ°é”™è¯¯ä¿¡æ¯çš„ï¼Œè€Œé”™è¯¯ä¿¡æ¯æ˜¯åœ¨æµè§ˆå™¨çš„å¼‚æ­¥é˜Ÿåˆ—ä¸­è¢«æŠ›å‡ºæ¥çš„ã€‚æ˜¯å› ä¸ºtryåªèƒ½catchåŒæ­¥ä»£ç çš„é”™è¯¯ï¼Œè€Œå¼‚æ­¥æ¨¡å¼ä¸‹çš„ä»£ç æŠ›é”™ï¼Œéœ€è¦ä½¿ç”¨å¼‚æ­¥æ¥å£ã€‚

#### 2.3 Promiseçš„å®ä¾‹æ–¹æ³•

##### 2.3.1 thenæ–¹æ³•



#### å¦‚ä½•å®ç° Promise

#### æ®‹ç•™çš„é—®é¢˜

> å½“æš´å›è¢«å‹‡è€…æ–©ä¸‹ï¼Œcallback hell ä¹Ÿéšé£è€Œå»ï¼Œæ–°æ—¶ä»£çš„å‹‡è€…å¸¦é¢†å¼€å‘è€…èµ°å‘æ–°æ—¶ä»£ï¼Œå³ä¾¿æ–°å‹‡è€…å¸¦ç€å¾€æ˜”çš„ç—•è¿¹ã€‚é»æ˜å·²ä¸è¿œã€‚

```javascript
//ä¸€ä¸ªæ§åˆ¶x,yè½´ç§»åŠ¨çš„å‡½æ•°
function promiseMove(x, y) {
  return new Promise(function (reslove, reject) {
    move(x, y, () => {
      if (success) {
        reslove("æˆåŠŸ");
      } //ç§»åŠ¨æˆåŠŸ
      if (error) {
        reject("å¤±è´¥");
      } //ç§»åŠ¨å¤±è´¥
    });
  });
}

promiseMove(100, 100)
  .then(function () {
    return promiseMove(200, 200);
  })
  .then(function () {
    return promiseMove(300, 300);
  })
  .then(function () {
    return promiseMove(400, 400);
  })
  .then(function () {
    return promiseMove(500, 500);
  })
  .then(function () {
    return promiseMove(600, 600);
  })
  .then(function () {
    return promiseMove(700, 700);
  })
  .then(function () {
    return promiseMove(800, 800);
  })
  .then(function () {
    return promiseMove(900, 900);
  })
  .then(function () {
    return promiseMove(1000, 1000);
  });
```

ä»é‡‘å­—å¡”æˆäº†å¤§æ–¹å—ï¼Œæ–‡æ˜å·²ç»è¿›æ­¥ï¼Œé»æ˜å°±åœ¨å‰æ–¹ã€‚

### Generator

> æ–°æ—¶ä»£å‰çš„ç°æš—

#### ä»€ä¹ˆæ˜¯ Generator

#### å¦‚ä½•ä½¿ç”¨ Generator

#### æ®‹ç•™çš„é—®é¢˜

Generator éœ€è¦åˆ†å¸ƒæ‰§è¡Œï¼Œæ–¹æ³•ä¹Ÿéœ€è¦æ‰‹åŠ¨æ‰§è¡Œã€‚è™½ç„¶ä» callback hell åˆ°äºŒç»´çš„ promiseï¼Œå†åˆ°ä¸€ç»´çš„ generatorï¼Œå¹¶æ²¡æœ‰è¾¾åˆ°å®Œç¾ï¼Œæœªæ¥å·²æ¥ã€‚

```javascript
function* moveGenerator(x, y) {
  for (let i = 1; i < 11; i++) {
    yield move(100 * i, 100 * i);
  }
}

let m = moveGenerator();
n.next(); //100,100
n.next(); //200,200
n.next(); //300,300
n.next(); //400,400
n.next(); //500,500
n.next(); //600,600
n.next(); //700,700
n.next(); //800,800
n.next(); //900,900
n.next(); //1000,1000
```

### async/await å‡½æ•°

#### ä»€ä¹ˆæ˜¯ async/await

#### è§£å†³äº†ä»€ä¹ˆé—®é¢˜

åŒæ ·æ˜¯ç§»åŠ¨ 10 æ¬¡çš„é—®é¢˜ï¼Œä½¿ç”¨ async/await ä¼šæ˜¯ä»€ä¹ˆæ ·ï¼Ÿ

```javascript
async function moveAsync() {
  for (let i = 1; i < 11; i++) {
    await move(100 * i, 100 * i);
  }
}
moveAsync();
```

å‰ç«¯çš„å¼‚æ­¥ä¸–ç•Œç»ˆäºä¸€ç‚¹ç‚¹çš„æ‘†è„±äº†å›è°ƒå‡½æ•°é€ æˆçš„æ··ä¹±ï¼Œç»å†äº† callback hell>promise>generator å†åˆ° async,å‰ç«¯å¼€å‘è€…ç»ˆäºè¿æ¥äº†å¼‚æ­¥ä¸–ç•ŒçœŸæ­£çš„ç®€æ´å’Œä¼˜é›…ã€‚
