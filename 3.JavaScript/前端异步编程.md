# å‰ç«¯å¼‚æ­¥ç¼–ç¨‹

> å½“æˆ‘ä»¬åœ¨è°ˆè®ºå¼‚æ­¥ç¼–ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨è°ˆè®ºä»€ä¹ˆï¼Ÿ

### å›è°ƒå‡½æ•°ï¼ˆcallback functionï¼‰-æ—§æ—¶ä»£çš„æ•‘æ˜Ÿ

> å·¨é¾™è‚†è™çš„æ‘åº„ï¼Œè¿æ¥äº†ä¸€ä½å‹‡å£«

####ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°

**A callback is a function that is passed as an argument to another function and is executed after its parent function has completed.**

Googleæä¾›çš„å®šä¹‰ï¼Œéå¸¸æ¸…æ™°ç®€æ˜ã€‚ä¸€ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªä½œä¸ºå…¶ä»–å‡½æ•°å‚æ•°çš„å‡½æ•°ï¼Œä¸€ä¸ªå…¶ä»–å‡½æ•°å®Œæˆåå†è¢«è°ƒç”¨çš„å‡½æ•°ã€‚

ğŸŒ°ï¼š

```javascript
$('body').click(function(){
  console.log('hah')
})
```

clickå‡½æ•°çš„å‚æ•°å°±æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆä¸‹æ–‡ç»Ÿç§°cbï¼‰ï¼Œè¿™ä¸ªcbæ˜¯clickå‡½æ•°çš„ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯åœ¨bodyå…ƒç´ è¢«ç‚¹å‡»åè¿è¡Œçš„å‡½æ•°ã€‚

#### ä¸ºä»€ä¹ˆéœ€è¦å›è°ƒå‡½æ•°

å…·ä½“æŸ¥çœ‹**jsçš„EventLoop**ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œjså¼•æ“æ˜¯å•çº¿ç¨‹ï¼Œæ¯æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°æ²¡æœ‰è¾¾åˆ°æ‰§è¡Œè¦æ±‚ï¼ˆä¾‹å¦‚ï¼šclickï¼‰,åˆ™ä¼šç­‰å¾…ç›´åˆ°bodyè¢«clickï¼Œè¿™æ ·ç¨‹åºå°±å¤„äºç±»ä¼¼å‡æ­»çŠ¶æ€ï¼Œæ˜¯å®Œå…¨ä¸èƒ½æ¥å—çš„ã€‚

æ•…å­•è‚²è€Œå‡º**å¼‚æ­¥æ¨¡å¼**ã€‚å³è¿è¡Œåˆ°æš‚æ—¶ä¸èƒ½é©¬ä¸Šå¾—åˆ°ç»“æœçš„å‡½æ•°(å³å¼‚æ­¥å‡½æ•°ä¾‹å¦‚ï¼šclick)æ—¶ï¼Œå…ˆæŠŠå‡½æ•°å¡å…¥å…¶ä»–çº¿ç¨‹ï¼ˆæµè§ˆå™¨äº‹ä»¶çº¿ç¨‹ï¼‰ï¼Œå½“è§¦å‘clickåå†åœ¨jså¼•æ“è¿è¡Œclickå‡½æ•°ä¸­cbã€‚åœ¨jså¼•æ“çœ‹æ¥ï¼Œcbåœ¨ä¹‹å‰çœ‹è§è¿‡ï¼Œä½†æ˜¯æ²¡æœ‰æ‰§è¡Œã€‚ç°åœ¨å› ä¸ºcalläº†clickï¼Œcbæ‰ä¼šbackã€‚è¿™å°±æ˜¯callbackã€‚

#### äº§ç”Ÿäº†é—®é¢˜

> å± é¾™çš„å‹‡å£«ï¼Œç»ˆæˆæš´å›

ç¨‹åºè®¾è®¡çš„æ„¿æ™¯æ˜¯å¥½çš„ï¼Œä½†åœ¨å®é™…å¤æ‚çš„ç”Ÿäº§è¿‡ç¨‹ä¸­ä¼šå‡ºç°æ¯”è¾ƒå½±å“ä»£ç å¯è¯»æ€§çš„é—®é¢˜ã€‚

å›è°ƒåœ°ç‹±ï¼ˆcallback hellï¼‰

**no BB show your code**

```javascript
function move(x,y,cb) {} //ä¸€ä¸ªæ§åˆ¶x,yè½´ç§»åŠ¨çš„å‡½æ•°

//å®ç°ç§»åŠ¨å¤šæ¬¡çš„éœ€æ±‚
move(100, 100, function () {
    move(200, 200, function () {
        move(300, 300, function () {
            move(400, 400, function () {
                move(500, 500, function () {
                    move(600, 600, function () {
                        move(700, 700, function () {
                            move(800, 800, function () {
                                move(900, 900, function () {
                                    move(1000, 2000, function () {
                                    })
                                })
                            })
                        })
                    })
                })
            })
        })
    })
})

```

ä¸Šé¢ä¾‹å­è¿˜æ²¡æœ‰æ·»åŠ å„ç§å›è°ƒå‡½æ•°çš„ä¸šåŠ¡é€»è¾‘ã€‚

ç±»ä¼¼äºé‡‘å­—å¡”èˆ¬çš„ç»“æ„ï¼Œæƒ³ä¸åˆ°ä»£ç æœ‰ä¸€å¤©èƒ½å¦‚æ­¤ä¼˜é›…ï¼ˆç¬‘ï¼Œè¿™ä¸ªé—®é¢˜åœ¨è›®è’æ—¶ä»£ä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æ–°å‹‡è€…çš„åˆ°æ¥ã€‚

### Promise-ES6æ—¶ä»£çš„å¼‚æ­¥å‹‡è€…

> éšç€ES6çš„æ›´æ–°ï¼Œè¿æ¥äº†æ–°çš„å‹‡è€…Promiseï¼Œä»æ­¤å‰ç«¯å‘Šåˆ«è›®è’çš„åˆ€å‰‘ï¼Œè¿›å…¥é­”æ³•æ—¶ä»£ã€‚

#### ä»€ä¹ˆæ˜¯Promise

#### å¦‚ä½•å®ç°Promise

#### æ®‹ç•™çš„é—®é¢˜

> å½“æš´å›è¢«å‹‡è€…æ–©ä¸‹ï¼Œcallback hellä¹Ÿéšé£è€Œå»ï¼Œæ–°æ—¶ä»£çš„å‹‡è€…å¸¦é¢†å¼€å‘è€…èµ°å‘æ–°æ—¶ä»£ï¼Œå³ä¾¿æ–°å‹‡è€…å¸¦ç€å¾€æ˜”çš„ç—•è¿¹ã€‚é»æ˜å·²ä¸è¿œã€‚

```javascript
//ä¸€ä¸ªæ§åˆ¶x,yè½´ç§»åŠ¨çš„å‡½æ•°
function promiseMove(x,y) {
    return new Promise(function (reslove, reject) {
      move(x,y,()=>{
        if (success) { reslove('æˆåŠŸ') }  //ç§»åŠ¨æˆåŠŸ
        if (error) { reject('å¤±è´¥') }  //ç§»åŠ¨å¤±è´¥
      })
    })
}

promiseMove(100,100)
  .then(function(){
    return promiseMove(200, 200)
}).then(function(){
    return promiseMove(300, 300)
}).then(function(){
    return promiseMove(400, 400)
}).then(function(){
    return promiseMove(500, 500)
}).then(function(){
    return promiseMove(600, 600)
}).then(function(){
    return promiseMove(700, 700)
}).then(function(){
    return promiseMove(800, 800)
}).then(function(){
    return promiseMove(900, 900)
}).then(function(){
    return promiseMove(1000, 1000)
})

```

ä»é‡‘å­—å¡”æˆäº†å¤§æ–¹å—ï¼Œæ–‡æ˜å·²ç»è¿›æ­¥ï¼Œé»æ˜å°±åœ¨å‰æ–¹ã€‚

### Generator-çŸ­æš‚çš„å¸Œæœ›

> æ–°æ—¶ä»£å‰çš„ç°æš—

#### ä»€ä¹ˆæ˜¯Generator

#### å¦‚ä½•ä½¿ç”¨Generator

#### æ®‹ç•™çš„é—®é¢˜

Generatoréœ€è¦åˆ†å¸ƒæ‰§è¡Œï¼Œæ–¹æ³•ä¹Ÿéœ€è¦æ‰‹åŠ¨æ‰§è¡Œã€‚è™½ç„¶ä»callback hellåˆ°äºŒç»´çš„promiseï¼Œå†åˆ°ä¸€ç»´çš„generatorï¼Œå¹¶æ²¡æœ‰è¾¾åˆ°å®Œç¾ï¼Œæœªæ¥å·²æ¥ã€‚

```javascript
function *moveGenerator(x,y){
  for(let i = 1;i<11;i++){
   yield move(100*i,100*i)
  }
}

let m = moveGenerator();
n.next()//100,100
n.next()//200,200
n.next()//300,300
n.next()//400,400
n.next()//500,500
n.next()//600,600
n.next()//700,700
n.next()//800,800
n.next()//900,900
n.next()//1000,1000
```

### async/awaitå‡½æ•°-çœŸæ­£çš„å‹‡è€…

#### ä»€ä¹ˆæ˜¯async/await

#### è§£å†³äº†ä»€ä¹ˆé—®é¢˜

åŒæ ·æ˜¯ç§»åŠ¨10æ¬¡çš„é—®é¢˜ï¼Œä½¿ç”¨async/awaitä¼šæ˜¯ä»€ä¹ˆæ ·ï¼Ÿ

```javascript
async function moveAsync(){
for(let i = 1;i<11;i++){
    await move(100*i,100*i)
  }
}
moveAsync()
```

å‰ç«¯çš„å¼‚æ­¥ä¸–ç•Œç»ˆäºä¸€ç‚¹ç‚¹çš„æ‘†è„±äº†å›è°ƒå‡½æ•°é€ æˆçš„æ··ä¹±ï¼Œç»å†äº†callback hell>promise>generatorå†åˆ°async,å‰ç«¯å¼€å‘è€…ç»ˆäºè¿æ¥äº†å¼‚æ­¥ä¸–ç•ŒçœŸæ­£çš„ç®€æ´å’Œä¼˜é›…ã€‚